//
//  WheelCTests.swift
//  
//
//  Created by Andr√© Rohrbeck on 31.12.22.
//

import Foundation
import EN15302
import XCTest


internal final class WheelCTests: XCTestCase {

    /// The profile values (z) for points every 1 mm in lateral direction, starting at -70.
    ///
    /// These are the values from Table I.3 in EN 15302:2021.
    private let expectedProfileZValues = [17.14158,
                                          23.12256,
                                          25.26789,
                                          26.61444,
                                          27.59941, // -66
                                          28.35171,
                                          28.93035,
                                          29.36756,
                                          29.68252,
                                          29.88693, // -61
                                          29.98756, // -60
                                          29.96542, // -59
                                          29.85391, // -58
                                          29.68515, // -57
                                          29.45748,
                                          29.16856,
                                          28.81523, // -54
                                          28.39330,
                                          27.89732,
                                          27.32008,
                                          26.65196,
                                          25.87981,
                                          24.98505, // -48
                                          23.94010,
                                          22.70091, //
                                          21.18901, // -45
                                          19.23478, // -44
                                          16.77851, // -43
                                          14.30342, // -42
                                          11.83037,
                                          9.90216,
                                          8.52374,
                                          7.44953,
                                          6.58341,
                                          5.87591,
                                          5.29780,
                                          4.83037,
                                          4.46105,
                                          4.17643,
                                          3.91823,
                                          3.67100,
                                          3.43466,
                                          3.20913,
                                          2.99434,
                                          2.79021,
                                          2.59668,
                                          2.41369,
                                          2.24118,
                                          2.07909,
                                          1.92737,
                                          1.78597,
                                          1.65486,
                                          1.53398,
                                          1.42209,
                                          1.31389,
                                          1.20876, // -15
                                          1.10672, // -14
                                          1.00776,
                                          0.91186, // -12
                                          0.81904, // -11
                                          0.72929,
                                          0.64260,
                                          0.55898,
                                          0.47841, // -7
                                          0.40091,
                                          0.32646,
                                          0.25507,
                                          0.18673,
                                          0.12144,
                                          0.05919, // -1
                                          0.00000,
                                          -0.05615,
                                          -0.10925,
                                          -0.15932, // 3
                                          -0.20634, // 4
                                          -0.25032,
                                          -0.29126,
                                          -0.32917,
                                          -0.36404,
                                          -0.39587,
                                          -0.42467,
                                          -0.45044,
                                          -0.47317,
                                          -0.49287,
                                          -0.50954,
                                          -0.52318,
                                          -0.53379, // 16
                                          -0.54136,
                                          -0.54591, // 18
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.54742,
                                          -0.64742,
                                          -0.74742,
                                          -0.84742,
                                          -0.94742,
                                          -1.04742,
                                          -1.14742,
                                          -1.24742,
                                          -1.34742,
                                          -1.44742,
                                          -1.54742,
                                          -1.64742,
                                          -1.74742,
                                          -1.84742,
                                          -1.94742,
                                          -2.04742,
                                          -2.14742,
                                          -2.24742,
                                          -2.34742,
                                          -2.44742,
                                          -2.54742,
                                          -2.64742,
                                          -2.74742,
                                          -2.84742,
                                          -2.94742,
                                          -3.04742,
                                          -3.14742,
                                          -3.24742,
                                          -3.34742,
                                          -3.44742,
                                          -3.54742,
                                          -4.54742,
                                          -5.54742,
                                          -6.54742,
                                          -7.54742,
                                          -8.54742,
                                          -9.54742]


    private var expectedProfile: [CGPoint] {
        (0..<(expectedProfileZValues.count)).map {
            CGPoint(x: -70.0 + Double($0),
                    y: -expectedProfileZValues[$0])
        }
    }


    internal func testProfileCorrectness() {
        let profile = EN15302.profile(.wheelC).profile(resolution: 1.0)

        XCTAssertEqual(profile, expectedProfile, accuracy: 0.00005)
        // TODO: should be more accurate as numbers are given with a resolution of 0.00001, should be
        // 0.000005 (5e-6) instead is 1 e-4!
    }
}
