//
//  WheelBTests.swift
//  
//
//  Created by Andr√© Rohrbeck on 31.12.22.
//

import Foundation
import EN15302
import XCTest


internal final class WheelBTests: XCTestCase {

    /// The profile values (z) for points every 1 mm in lateral direction, starting at -70.
    ///
    /// These are the values from Table I.2 in EN 15302:2021.
    private let expectedProfileZValues = [9.51930,
                                          15.84386,
                                          18.35106,
                                          20.19638,
                                          21.68483,
                                          22.93571,
                                          24.01068,
                                          24.94655,
                                          25.74679, // 62
                                          26.39230, // 61
                                          26.90871,
                                          27.31371,
                                          27.61895,
                                          27.83216,
                                          27.95826,
                                          28.00000,
                                          27.95826,
                                          27.83216,
                                          27.61895,
                                          27.31371,
                                          26.90871,
                                          26.40302,
                                          25.82084,
                                          25.15684,
                                          24.40054,
                                          23.53771,
                                          22.54825,
                                          21.40229,
                                          20.05197,
                                          18.41123,
                                          16.29074,
                                          13.57580,
                                          11.22110,
                                          9.60992,
                                          8.37349,
                                          7.37735,
                                          6.55732,
                                          5.87697,
                                          5.31340,
                                          4.85133,
                                          4.48019, // -30
                                          4.18822, // -29
                                          3.92061,
                                          3.66222,
                                          3.41299, // -26
                                          3.17284,
                                          2.94174, // -24
                                          2.71961,
                                          2.50642,
                                          2.30212, // -21
                                          2.10665, // -20
                                          1.91997,
                                          1.74205,
                                          1.57284,
                                          1.41230,
                                          1.26041,
                                          1.11712,
                                          0.98241,
                                          0.85625,
                                          0.73861, // -11
                                          0.62946,
                                          0.52878,
                                          0.43655,
                                          0.35276, // -7
                                          0.27737,
                                          0.21039, // -5
                                          0.15178,
                                          0.10155,
                                          0.05967,
                                          0.02615,
                                          0.00000,
                                          -0.02500,
                                          -0.05000,
                                          -0.07500,
                                          -0.10000,
                                          -0.12500,
                                          -0.15000,
                                          -0.17500,
                                          -0.20000,
                                          -0.22500,
                                          -0.25000,
                                          -0.27500,
                                          -0.30000,
                                          -0.32500,
                                          -0.35000,
                                          -0.37500,
                                          -0.40000,
                                          -0.42500,
                                          -0.45000,
                                          -0.47500,
                                          -0.50000,
                                          -0.52500,
                                          -0.55000,
                                          -0.57500,
                                          -0.60000,
                                          -0.62500,
                                          -0.65000,
                                          -0.67500,
                                          -0.70000,
                                          -0.72500,
                                          -0.75000,
                                          -0.80000,
                                          -0.85000,
                                          -0.90000,
                                          -0.95000,
                                          -1.00000,
                                          -1.05000,
                                          -1.10000,
                                          -1.15000,
                                          -1.20000,
                                          -1.25000,
                                          -1.30000,
                                          -1.35000,
                                          -1.40000,
                                          -1.45000,
                                          -1.50000,
                                          -1.55000,
                                          -1.60000,
                                          -1.65000,
                                          -1.70000,
                                          -1.75000,
                                          -1.80000,
                                          -1.85000,
                                          -1.90000,
                                          -1.95000,
                                          -2.00000,
                                          -2.05000,
                                          -2.10000,
                                          -2.15000,
                                          -2.20000,
                                          -2.25000,
                                          -3.25000,
                                          -4.25000,
                                          -5.25000,
                                          -6.25000,
                                          -7.25000]


    private var expectedProfile: [CGPoint] {
        (0..<(expectedProfileZValues.count)).map {
            CGPoint(x: -70.0 + Double($0),
                    y: -expectedProfileZValues[$0])
        }
    }


    internal func testProfileCorrectness() {
        let profile = EN15302.profile(.wheelB).profile(resolution: 1.0)

        XCTAssertEqual(profile, expectedProfile, accuracy: 0.00001)
        // TODO: should be more accurate as numbers are given with a resolution of 0.00001, should be
        // 0.000005 (5e-6) instead is 1 e-4!
        // 0.000005 (5e-6) instead is 1 e-4!
    }
}
