//
//  WheelHTests.swift
//  
//
//  Created by Andr√© Rohrbeck on 31.12.22.
//

import Foundation
import EN15302
import XCTest


internal final class WheelHTests: XCTestCase {

    /// The profile values (z) for points every 1 mm in lateral direction, starting at -70.
    ///
    /// These are the values from Table I.4 in EN 15302:2021.
    private let expectedProfileZValues = [9.51930,
                                          15.84386,
                                          18.35106,
                                          20.19638,
                                          21.68483, // -66
                                          22.93571,
                                          24.01068,
                                          24.94655,
                                          25.74679,
                                          26.39230, // -61
                                          26.90871, // -60
                                          27.31371, // -59
                                          27.61895, // -58
                                          27.83216, // -57
                                          27.95826,
                                          28.00000,
                                          27.95826, // -54
                                          27.83216,
                                          27.61895,
                                          27.31371,
                                          26.90871,
                                          26.40302,
                                          25.82084, // -48
                                          25.15684,
                                          24.40054, //
                                          23.53771, // -45
                                          22.54825, // -44
                                          21.40229, // -43
                                          20.05197, // -42
                                          18.41123,
                                          16.29074,
                                          13.57580,
                                          11.16578,
                                          9.52128,
                                          8.26553,
                                          7.25596,
                                          6.42565,
                                          5.73691,
                                          5.16617,
                                          4.69778,
                                          4.32091,
                                          4.02791,
                                          3.80980,
                                          3.60980,
                                          3.40980,
                                          3.20980,
                                          3.00980,
                                          2.80980,
                                          2.60980,
                                          2.40980,
                                          2.20980,
                                          2.00980,
                                          1.80980,
                                          1.60980,
                                          1.40980,
                                          1.20980, // -15
                                          1.00980, // -14
                                          0.80980,
                                          0.60980, // -12
                                          0.40980, // -11
                                          0.25000,
                                          0.22500,
                                          0.20000,
                                          0.17500, // -7
                                          0.15000,
                                          0.12500,
                                          0.10000,
                                          0.07500,
                                          0.05000,
                                          0.02500, // -1
                                          0.00000,
                                          -0.02500,
                                          -0.05000,
                                          -0.07500, // 3
                                          -0.10000, // 4
                                          -0.12500,
                                          -0.15000,
                                          -0.17500,
                                          -0.20000,
                                          -0.22500,
                                          -0.25000,
                                          -0.27500,
                                          -0.30000,
                                          -0.32500,
                                          -0.35000,
                                          -0.37500,
                                          -0.40000, // 16
                                          -0.42500,
                                          -0.45000, // 18
                                          -0.47500,
                                          -0.50000,
                                          -0.52500,
                                          -0.55000,
                                          -0.57500,
                                          -0.60000,
                                          -0.62500,
                                          -0.65000,
                                          -0.67500,
                                          -0.70000,
                                          -0.72500,
                                          -0.75000,
                                          -0.81670,
                                          -0.88340,
                                          -0.95010,
                                          -1.01680,
                                          -1.08350,
                                          -1.15020,
                                          -1.21690,
                                          -1.28360,
                                          -1.35030,
                                          -1.41700,
                                          -1.48370,
                                          -1.55040,
                                          -1.61710,
                                          -1.68380,
                                          -1.75050,
                                          -1.81720,
                                          -1.88390,
                                          -1.95060,
                                          -2.01730,
                                          -2.08400,
                                          -2.15070,
                                          -2.21740,
                                          -2.28410,
                                          -2.35080,
                                          -2.41750,
                                          -2.48420,
                                          -2.55090,
                                          -2.61760,
                                          -2.68430,
                                          -2.75100,
                                          -3.75100,
                                          -4.75100,
                                          -5.75100,
                                          -6.75100,
                                          -7.75100]


    private var expectedProfile: [CGPoint] {
        (0..<(expectedProfileZValues.count)).map {
            CGPoint(x: -70.0 + Double($0),
                    y: -expectedProfileZValues[$0])
        }
    }


    internal func testProfileCorrectness() {
        let profile = EN15302.profile(.wheelH).profile(resolution: 1.0)

        XCTAssertEqual(profile, expectedProfile, accuracy: 0.0000055)
        // TODO: should be more accurate as numbers are given with a resolution of 0.00001, should be
        // 0.000005 (5e-6) instead is 1 e-4!
    }
}
