//
//  WheelITests.swift
//  
//
//  Created by Andr√© Rohrbeck on 31.12.22.
//

import Foundation
import EN15302
import XCTest


internal final class WheelITests: XCTestCase {

    /// The profile values (z) for points every 1 mm in lateral direction, starting at -70.
    ///
    /// These are the values from Table I.5 in EN 15302:2021.
    private let expectedProfileZValues = [9.51929,
                                          15.84384, // -69
                                          18.35105,
                                          20.19637,
                                          21.68481, // -66
                                          22.93570,
                                          24.01066, // -64
                                          24.94654,
                                          25.74733,
                                          26.39284,
                                          26.90925,
                                          27.31424, // -59
                                          27.61949,
                                          27.83270,
                                          27.95880,
                                          28.00054,
                                          27.95880,
                                          27.83270,
                                          27.61949,
                                          27.31424, // -51
                                          26.90925,
                                          26.40357,
                                          25.82139,
                                          25.15739,
                                          24.40109,
                                          23.53825, // -45
                                          22.54879, // -44
                                          21.40284,
                                          20.05252,
                                          18.41178,
                                          16.29128, // -40
                                          13.57758,
                                          11.46753,
                                          9.97487,
                                          8.80989,
                                          7.86433,
                                          7.08353,
                                          6.43544,
                                          5.89958,
                                          5.46209,
                                          5.11332,
                                          4.81321,
                                          4.52248,
                                          4.24113,
                                          3.96909,
                                          3.70629,
                                          3.45267,
                                          3.20817,
                                          2.97274,
                                          2.74631,
                                          2.52884,
                                          2.32028,
                                          2.12058,
                                          1.92969,
                                          1.74758,
                                          1.57419, // -15
                                          1.40950, // -14
                                          1.25347,
                                          1.10606, // -12
                                          0.96724, // -11
                                          0.83698,
                                          0.71525,
                                          0.60203,
                                          0.49730, // -7
                                          0.40102,
                                          0.31318,
                                          0.23376,
                                          0.16275,
                                          0.10013,
                                          0.04588, // -1
                                          0.00000,
                                          -0.03753,
                                          -0.06671,
                                          -0.08754, // 3
                                          -0.10005, // 4
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421, // 16
                                          -0.10421,
                                          -0.10421, // 18
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.10421,
                                          -0.17091,
                                          -0.23761,
                                          -0.30431,
                                          -0.37101,
                                          -0.43771,
                                          -0.50441,
                                          -0.57111,
                                          -0.63781,
                                          -0.70451,
                                          -0.77121,
                                          -0.83791,
                                          -0.90461,
                                          -0.97131,
                                          -1.03801,
                                          -1.10471,
                                          -1.17141,
                                          -1.23811,
                                          -1.30481,
                                          -1.37151,
                                          -1.43821,
                                          -1.50491,
                                          -1.57161,
                                          -1.63831,
                                          -1.70501,
                                          -1.77171,
                                          -1.83841,
                                          -1.90511,
                                          -1.97181,
                                          -2.03851,
                                          -2.10521,
                                          -3.10521,
                                          -4.10521,
                                          -5.10521,
                                          -6.10521,
                                          -7.10521]


    private var expectedProfile: [CGPoint] {
        (0..<(expectedProfileZValues.count)).map {
            CGPoint(x: -70.0 + Double($0),
                    y: -expectedProfileZValues[$0])
        }
    }


    internal func testProfileCorrectness() {
        let profile = EN15302.profile(.wheelI).profile(resolution: 1.0)

        XCTAssertEqual(profile, expectedProfile, accuracy: 0.00001)
        // TODO: should be more accurate as numbers are given with a resolution of 0.00001, should be
        // 0.000005 (5e-6) instead is 1 e-4!
    }
}
